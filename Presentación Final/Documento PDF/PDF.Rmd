---
title: "La Fórmula 1"
subtitle: "Proyecto Final"
output: pdf_document
date: "Marzo de 2025"
fontsize: 12pt
lang: es-Mx
toc: TRUE
---

```{r setup, include=FALSE}

#inserción de data frame en Rstudio y llamado de librerias

library(tidyverse)
library(stringr)
library(stringi)
library(readr)
library(gt) 
library(dplyr)
library(knitr)
library(tinytex) 
library(readxl)
library(dplyr)
library(RSQLite)
library(DBI)
library(writexl)

# Conexión con data SQLite

con <- dbConnect(RSQLite::SQLite(), dbname = "Formula1.sqlite")
tablas <- dbListTables(con)
print(tablas)

# Query y creación de data frame

DfFormula1 <- dbReadTable(con, tablas[1]) 

corredores <-"SELECT * FROM drivers" 
dfcorredores <- dbGetQuery(con ,corredores) 

circuitos <-"SELECT * FROM circuits" 

DfCircutitos <- dbGetQuery(con, circuitos)

DfCircuitos <- dbReadTable(con, "circuits")

#Salida de archivo excel para toda la base de datos

lista_de_datos <- list()
for (tabla in tablas) {
  datos <- dbReadTable(con, tabla)
  lista_de_datos[[tabla]] <- datos
}
write_xlsx(lista_de_datos, "Formula1.xlsx")


# Cerrar la conexión a la base de datos
dbDisconnect(con)

```

![logo de la Universidad Central de Venezuela (UCV)](ucv.png)

\pagebreak

### **Resumen**

La Fórmula 1 es la máxima categoría del automovilismo, un deporte que fusiona tecnología de punta, habilidad humana y estrategia. El análisis estadístico juega un papel crucial en la evaluación del rendimiento de pilotos y escuderías. En este contexto, el trabajo se centra en analizar el rendimiento de los cinco mejores pilotos y equipos durante las últimas cinco temporadas (2013-2017), un período marcado por la transición a motores híbridos.

El estudio busca identificar los factores clave del éxito, analizando variables como velocidad, tiempos de vuelta, paradas en boxes y puntos acumulados con el objetivo de contribuir a una comprensión más profunda de la Fórmula 1 como un deporte donde la estrategia y habilidad se entrelazan.

## **CAPÍTULO 1: PROBLEMA DE INVESTIGACIÓN**

### **1.1 Planteamiento del problema**

La Fórmula 1 tiene sus raíces en las carreras automovilísticas surgidas en Francia en 1894. De 1927 a 1934, el número de carreras consideradas Gran Premio creció hasta alcanzar dieciocho en 1934, el máximo antes de la Segunda Guerra Mundial. Inmediatamente después de la Segunda Guerra Mundial sólo hubo 4 carreras con categoría de Gran Premio. Hasta que, en 1947, la antigua AIACR se reorganizó, pasándose a llamar la Federación Internacional de Automovilismo (FIA). Organismo rector de deporte motor y promueve la movilidad segura, sostenible, y accesible para todos los usuarios de carreras de todo el mundo con sede en París, anunció que para 1950 unirían varios Grandes Premios para crear el Campeonato del Mundo de Fórmula 1 de Pilotos. Se estableció un sistema de puntuación y acordaron un total de siete carreras aptas para tal celebración.

La primera carrera del Mundial se disputó el 13 de mayo en el circuito de Silverstone (Reino Unido). Los italianos fueron los protagonistas en estas primeras carreras del Campeonato del Mundo, tanto las marcas como los pilotos. El primer campeón del mundo fue Giuseppe Farina, al volante de un Alfa Romeo.

La Fórmula 1 ha tenido a grandes pilotos que hicieron historia, nombres como Lewis Hamilton, Nikki Lauda y Checo Pérez se han convertido en sinónimos de velocidad y de adrenalina, de vivir al límite, y son ellos los que han conseguido superar tiempos extraordinarios. De igual forma la misma Fórmula 1 realizó un estudio para determinar qué pilotos han sido los más veloces en una sola vuelta en los últimos 40 años. En conjunto con Amazon Web Services, la F1 tomó datos de 1983, con lo que encontraron un top de pilotos que han alcanzado velocidades impresionantes.

Es así como se determina que la historia de la Fórmula 1 ha atravesado muchísimos momentos. Desde su fundación oficial en 1950, diversos pilotos han marcado décadas y generaciones por lo cual dada la información proporcionada anteriormente se propone un estudio detallado para identificar en la actualidad el rendimiento de los mejores pilotos y subsecuentemente sus escuderías.

### **1.2 Formulación del problema**

¿Cuál fue el rendimiento de las últimas 5 temporadas de los cinco mejores pilotos y escuderías durante el periodo 2013 - 2017?

### **1.3 Objetivos**

#### **Objetivo general**

Determinar el rendimiento de los mejores 5 pilotos y escuderías de las últimas 5 (2013-2017) temporadas de la F1

#### **Objetivos específicos**

1)  Identificar los últimos 5 mejores pilotos y escuderías de las últimas 5 temporadas.
2)  Determinar el número total de puntos acumulados por cada piloto y equipo en cada temporada y realizar una comparación entre ellas
3)  Cuantificar el número de carreras ganadas por cada piloto y equipo
4)  Encontrar el número de veces en cada piloto y equipo ha terminado entre los tres primeros
5)  Medir el número de vueltas más rápidas registrada por cada piloto
6)  Evaluar el número de retiro por fallas mecánicas o parada en boxes

### **1.5 Finalidad de la Investigación**

Estudiar el desempeño de los mejores pilotos y sus escuderías correspondientes a lo largo de las últimas 5 temporadas analizando las estadísticas y estrategias de los equipos durante las carreras, incluyendo la parada en boxes para determinar las distintas variables presentes en cada equipo y así obtener los datos que ha llevado a la victoria o a estar cerca de la misma, de mucho de estos, logrando así la posibilidad de crear un precedente importante para futuros estudios y análisis, referenciando de igual forma la visión del lector y la manera en cómo ve este deporte.

### **1.6 Alcance de la Investigación**

#### **Cobertura horizontal**

Escuela de Estadística y Ciencias Actuariales. Universidad Central de Venezuela (UCV). Parroquia San Pedro. Municipio Libertador. Caracas. Venezuela.

#### **Cobertura vertical**

Escuderías, Rendimiento, Pilotos

```{r}
# Observar los mejores corredores del año 2017 en base a la suma de sus puntos y victorias

Mejores_en_2017 <- "
SELECT
    a.driverRef AS Referencia,
    a.forename AS Nombre,
    a.surname Apellido,
    a.number AS Número,
    d.year AS Año,
    SUM(b.points) AS TotalPuntos,
    sum(b.wins) AS TotalVictorias
FROM drivers a
INNER JOIN driver_standings b ON a.driverId = b.driverId
INNER JOIN races c ON b.raceId = c.raceId
INNER JOIN seasons d ON c.year = d.year
WHERE d.year = 2017
GROUP BY a.driverId
ORDER BY TotalPuntos DESC
LIMIT 5;
"
Mejores_2017 <- dbGetQuery(con, Mejores_en_2017)
```

## **Histograma de Puntos y Victorias de Corredores Destacados en 2017**

```{r}

```


```{r}
# Observar los mejores corredores del año 2016 en base a la suma de sus puntos y victorias

Mejores_en_2016 <- "
SELECT
    a.driverRef AS Referencia,
    a.forename AS Nombre,
    a.surname Apellido,
    a.number AS Número,
    d.year AS Año,
    SUM(b.points) AS TotalPuntos,
    sum(b.wins) AS TotalVictorias
FROM drivers a
INNER JOIN driver_standings b ON a.driverId = b.driverId
INNER JOIN races c ON b.raceId = c.raceId
INNER JOIN seasons d ON c.year = d.year
WHERE d.year = 2016
GROUP BY a.driverId
ORDER BY TotalPuntos DESC
LIMIT 5;
"
Mejores_2016 <- dbGetQuery(con, Mejores_en_2016)

```

```{r}
# Observar los mejores corredores del año 2015 en base a la suma de sus puntos y victorias

Mejores_en_2015 <- "
SELECT
    a.driverRef AS Referencia,
    a.forename AS Nombre,
    a.surname Apellido,
    a.number AS Número,
    d.year AS Año,
    SUM(b.points) AS TotalPuntos,
    sum(b.wins) AS TotalVictorias
FROM drivers a
INNER JOIN driver_standings b ON a.driverId = b.driverId
INNER JOIN races c ON b.raceId = c.raceId
INNER JOIN seasons d ON c.year = d.year
WHERE d.year = 2015
GROUP BY a.driverId
ORDER BY TotalPuntos DESC
LIMIT 5;
"

Mejores_2015 <- dbGetQuery(con, Mejores_en_2015)
```

```{r}
# Observar los mejores corredores del año 2014 en base a la suma de sus puntos y victorias

Mejores_en_2014 <- "
SELECT
    a.driverRef AS Referencia,
    a.forename AS Nombre,
    a.surname Apellido,
    a.number AS Número,
    d.year AS Año,
    SUM(b.points) AS TotalPuntos,
    sum(b.wins) AS TotalVictorias
FROM drivers a
INNER JOIN driver_standings b ON a.driverId = b.driverId
INNER JOIN races c ON b.raceId = c.raceId
INNER JOIN seasons d ON c.year = d.year
WHERE d.year = 2014
GROUP BY a.driverId
ORDER BY TotalPuntos DESC
LIMIT 5;
"

Mejores_2014 <- dbGetQuery(con, Mejores_en_2014)
```

```{r}
# Observar los mejores corredores del año 2013 en base a la suma de sus puntos y victorias

Mejores_en_2013 <- "
SELECT
    a.driverRef AS Referencia,
    a.forename AS Nombre,
    a.surname Apellido,
    a.number AS Número,
    d.year AS Año,
    SUM(b.points) AS TotalPuntos,
    sum(b.wins) AS TotalVictorias
FROM drivers a
INNER JOIN driver_standings b ON a.driverId = b.driverId
INNER JOIN races c ON b.raceId = c.raceId
INNER JOIN seasons d ON c.year = d.year
WHERE d.year = 2013
GROUP BY a.driverId
ORDER BY TotalPuntos DESC
LIMIT 5;
"

Mejores_2013 <- dbGetQuery(con, Mejores_en_2013)

#### DE ESTA FORMA OBTENEMOS EN TABLAS LOS 5 MEJORES CORREDORES DURANTE 2013 - 2017 ###
```

```{r}

#### MEJORES ESCUDERIAS EN BASE SUS PUNTOS Y VICTORIAS DURANTE 2017 - 2013 ####

### Mejores escuderias en 2017 ##

mejores_escuderias_2017 <- "SELECT
a.constructorId AS ID,
a.name AS Escuderia,
c.year AS Año,
SUM(b.points) AS TotalPuntos,
sum(b.wins) AS TotalVictorias
FROM constructors a
INNER JOIN constructor_standings b ON a.constructorId = b.constructorId
INNER JOIN races c ON c.raceId = b.raceId
WHERE c.year = 2017
GROUP BY a.constructorId
ORDER BY TotalPuntos DESC
LIMIT 5;"

Escuderias_2017 <- dbGetQuery(con, mejores_escuderias_2017)

```

```{r}
## Mejores escuderias en 2016 ##

mejores_escuderias_2016 <- "SELECT
a.constructorId AS ID,
a.name AS Escuderia,
c.year AS Año,
SUM(b.points) AS TotalPuntos,
sum(b.wins) AS TotalVictorias
FROM constructors a
INNER JOIN constructor_standings b ON a.constructorId = b.constructorId
INNER JOIN races c ON c.raceId = b.raceId
WHERE c.year = 2016
GROUP BY a.constructorId
ORDER BY TotalPuntos DESC
LIMIT 5;"

Escuderias_2016 <- dbGetQuery(con, mejores_escuderias_2016)

```

```{r}

## Mejores escuderias en 2015 ##

mejores_escuderias_2015 <- "SELECT
a.constructorId AS ID,
a.name AS Escuderia,
c.year AS Año,
SUM(b.points) AS TotalPuntos,
sum(b.wins) AS TotalVictorias
FROM constructors a
INNER JOIN constructor_standings b ON a.constructorId = b.constructorId
INNER JOIN races c ON c.raceId = b.raceId
WHERE c.year = 2015
GROUP BY a.constructorId
ORDER BY TotalPuntos DESC
LIMIT 5;"

Escuderias_2015 <- dbGetQuery(con, mejores_escuderias_2015)
```

```{r}
## Mejores escuderias en 2014 ##

mejores_escuderias_2014 <- "SELECT
a.constructorId AS ID,
a.name AS Escuderia,
c.year AS Año,
SUM(b.points) AS TotalPuntos,
sum(b.wins) AS TotalVictorias
FROM constructors a
INNER JOIN constructor_standings b ON a.constructorId = b.constructorId
INNER JOIN races c ON c.raceId = b.raceId
WHERE c.year = 2014
GROUP BY a.constructorId
ORDER BY TotalPuntos DESC
LIMIT 5;"

Escuderias_2014 <- dbGetQuery(con, mejores_escuderias_2014)

```

```{r}
## Mejores escuderias en 2013 ##

mejores_escuderias_2013 <- "SELECT
a.constructorId AS ID,
a.name AS Escuderia,
c.year AS Año,
SUM(b.points) AS TotalPuntos,
sum(b.wins) AS TotalVictorias
FROM constructors a
INNER JOIN constructor_standings b ON a.constructorId = b.constructorId
INNER JOIN races c ON c.raceId = b.raceId
WHERE c.year = 2013
GROUP BY a.constructorId
ORDER BY TotalPuntos DESC
LIMIT 5;"

Escuderias_2013 <- dbGetQuery(con, mejores_escuderias_2013)

## DE ESTA FORMA OBTENEMOS LAS 5 MEJORES ESCUDERIAS DURANTE 2017 - 2013 ##
```

```{r}
## NUMERO DE VECES EN QUE CADA PILOTO HA TERMINADO ENTRE LOS TRES PRIMEROS ENTRE EL 2013 Y 2017 ##

## 2013 ##

Podios_2013 <- "SELECT d.driverId AS ID_Pilotos,
d.forename AS Nombre,
       d.surname AS Apellido,
       s.year AS temporada,   
       SUM(CASE WHEN r.position = 1 THEN 1 ELSE 0 END) AS Podios_1,
       SUM(CASE WHEN r.position = 2 THEN 1 ELSE 0 END) AS Podios_2,
       SUM(CASE WHEN r.position = 3 THEN 1 ELSE 0 END) AS Podios_3,
       COUNT(r.position) AS Cantidad_Podios
FROM  
       results r 
INNER JOIN 
       drivers d ON d.driverId = r.driverId
INNER JOIN 
     races s ON s.raceId = r.raceId
WHERE 
       r.position IN (1, 2, 3) AND
	   s.year = 2013
GROUP BY
       d.driverId, 
	   d.forename, d.surname
ORDER BY Cantidad_Podios DESC
LIMIT 3;"

Podios_2013 <- dbGetQuery(con, Podios_2013) 
```

```{r}
## 2014 ##

Podios_2014 <- "SELECT d.driverId AS ID_Pilotos,
       d.forename AS Nombre,
       d.surname AS Apellido,
       s.year AS temporada,   
       SUM(CASE WHEN r.position = 1 THEN 1 ELSE 0 END) AS Podios_1,
       SUM(CASE WHEN r.position = 2 THEN 1 ELSE 0 END) AS Podios_2,
       SUM(CASE WHEN r.position = 3 THEN 1 ELSE 0 END) AS Podios_3,
       COUNT(r.position) AS Cantidad_Podios
FROM  
       results r 
INNER JOIN 
       drivers d ON d.driverId = r.driverId
INNER JOIN 
     races s ON s.raceId = r.raceId
WHERE 
       r.position IN (1, 2, 3) AND
	   s.year = 2014
GROUP BY
       d.driverId, 
	   d.forename, d.surname
ORDER BY Cantidad_Podios DESC
LIMIT 3;"

Podios_2014 <- dbGetQuery(con, Podios_2014) 

```

```{r}
## 2015 ## 

Podios_2015 <- "SELECT d.driverId AS ID_Pilotos,
       d.forename AS Nombre,
       d.surname AS Apellido,
       s.year AS temporada,   
       SUM(CASE WHEN r.position = 1 THEN 1 ELSE 0 END) AS Podios_1,
       SUM(CASE WHEN r.position = 2 THEN 1 ELSE 0 END) AS Podios_2,
       SUM(CASE WHEN r.position = 3 THEN 1 ELSE 0 END) AS Podios_3,
       COUNT(r.position) AS Cantidad_Podios
FROM  
       results r 
INNER JOIN 
       drivers d ON d.driverId = r.driverId
INNER JOIN 
     races s ON s.raceId = r.raceId
WHERE 
       r.position IN (1, 2, 3) AND
	   s.year = 2015
GROUP BY
       d.driverId, 
	   d.forename, d.surname
ORDER BY Cantidad_Podios DESC
LIMIT 3;"

Podios_2015 <- dbGetQuery(con, Podios_2015) 

```

```{r}
## 2016 ## 

Podios_2016 <- "SELECT d.driverId AS ID_Pilotos,
       d.forename AS Nombre,
       d.surname AS Apellido,
       s.year AS temporada,   
       SUM(CASE WHEN r.position = 1 THEN 1 ELSE 0 END) AS Podios_1,
       SUM(CASE WHEN r.position = 2 THEN 1 ELSE 0 END) AS Podios_2,
       SUM(CASE WHEN r.position = 3 THEN 1 ELSE 0 END) AS Podios_3,
       COUNT(r.position) AS Cantidad_Podios
FROM  
       results r 
INNER JOIN 
       drivers d ON d.driverId = r.driverId
INNER JOIN 
     races s ON s.raceId = r.raceId
WHERE 
       r.position IN (1, 2, 3) AND
	   s.year = 2016
GROUP BY
       d.driverId, 
	   d.forename, d.surname
ORDER BY Cantidad_Podios DESC
LIMIT 3;"

Podios_2016 <- dbGetQuery(con, Podios_2016) 

```

```{r}
## 2017 ##

Podios_2017 <- "SELECT d.driverId AS ID_Pilotos,
       d.forename AS Nombre,
       d.surname AS Apellido,
       s.year AS temporada,   
       SUM(CASE WHEN r.position = 1 THEN 1 ELSE 0 END) AS Podios_1,
       SUM(CASE WHEN r.position = 2 THEN 1 ELSE 0 END) AS Podios_2,
       SUM(CASE WHEN r.position = 3 THEN 1 ELSE 0 END) AS Podios_3,
       COUNT(r.position) AS Cantidad_Podios
FROM  
       results r 
INNER JOIN 
       drivers d ON d.driverId = r.driverId
INNER JOIN 
     races s ON s.raceId = r.raceId
WHERE 
       r.position IN (1, 2, 3) AND
	   s.year = 2017
GROUP BY
       d.driverId, 
	   d.forename, d.surname
ORDER BY Cantidad_Podios DESC
LIMIT 3;"

Podios_2017 <- dbGetQuery(con, Podios_2017) 

```

```{r}
## Número DE RETIROS POR FALLAS MECANICAS y PARADAS EN LOS BOXES EN EL AÑO 2017 ##

Retiro_Fallas_Parada_boxes_2017 <- "SELECT r.year AS Año,
       r.name AS carrera,
       d.forename || ' ' || d.driverRef AS Piloto,
       COUNT(DISTINCT CASE WHEN s.status like '%Mechanical%' OR '%Electrical%' OR '%Engine misfire%' OR '%Engine fire%'  THEN res.resultId END) AS retiros_por_fallas_mecanicas,
       COUNT(DISTINCT ps.stop) AS paradas_en_boxes
FROM drivers d INNER JOIN results res ON d.driverId = res.driverId
INNER JOIN driver_standings e ON d.driverId = e.driverId
INNER JOIN races r ON res.raceId = r.raceId
LEFT JOIN status s ON res.statusId = s.statusId
LEFT JOIN pitstops ps ON d.driverId = ps.driverId AND r.raceId = ps.raceId
WHERE r.year == 2017 AND d.driverRef IN ('hamilton', 'vettel', 'bottas', 'ricciardo', 'raikkonen')
GROUP BY d.driverId, r.raceId
ORDER BY paradas_en_boxes AND retiros_por_fallas_mecanicas DESC;"

Retiro_Fallas_Parada_boxes_2017 <- dbGetQuery(con, Retiro_Fallas_Parada_boxes_2017)
```

```{r}
## Número DE RETIROS POR FALLAS MECANICAS y PARADAS EN LOS BOXES EN EL AÑO 2016 ##

Retiro_Fallas_Parada_boxes_2016 <- "SELECT r.year AS Año,
       r.name AS carrera,
       d.forename || ' ' || d.driverRef AS Piloto,
       COUNT(DISTINCT CASE WHEN s.status like '%Mechanical%' OR '%Electrical%' OR '%Engine misfire%' OR '%Engine fire%'  THEN res.resultId END) AS retiros_por_fallas_mecanicas,
       COUNT(DISTINCT ps.stop) AS paradas_en_boxes
FROM drivers d INNER JOIN results res ON d.driverId = res.driverId
INNER JOIN driver_standings e ON d.driverId = e.driverId
INNER JOIN races r ON res.raceId = r.raceId
LEFT JOIN status s ON res.statusId = s.statusId
LEFT JOIN pitstops ps ON d.driverId = ps.driverId AND r.raceId = ps.raceId
WHERE r.year == 2016 AND d.driverRef IN ('rosberg', 'hamilton', 'ricciardo', 'vettel', 'raikkonen')
GROUP BY d.driverId, r.raceId
ORDER BY paradas_en_boxes AND retiros_por_fallas_mecanicas DESC;"

Retiro_Fallas_Parada_boxes_2016 <- dbGetQuery(con, Retiro_Fallas_Parada_boxes_2016)
```

```{r}
## Número DE RETIROS POR FALLAS MECANICAS y PARADAS EN LOS BOXES EN EL AÑO 2015 ##

Retiro_Fallas_Parada_boxes_2015 <- "SELECT r.year AS Año,
       r.name AS carrera,
       d.forename || ' ' || d.driverRef AS Piloto,
       COUNT(DISTINCT CASE WHEN s.status like '%Mechanical%' OR '%Electrical%' OR '%Engine misfire%' OR '%Engine fire%'  THEN res.resultId END) AS retiros_por_fallas_mecanicas,
       COUNT(DISTINCT ps.stop) AS paradas_en_boxes
FROM drivers d INNER JOIN results res ON d.driverId = res.driverId
INNER JOIN driver_standings e ON d.driverId = e.driverId
INNER JOIN races r ON res.raceId = r.raceId
LEFT JOIN status s ON res.statusId = s.statusId
LEFT JOIN pitstops ps ON d.driverId = ps.driverId AND r.raceId = ps.raceId
WHERE r.year == 2015 AND d.driverRef IN ('hamilton', 'rosberg', 'vettel', 'raikkonen', 'bottas')
GROUP BY d.driverId, r.raceId
ORDER BY paradas_en_boxes AND retiros_por_fallas_mecanicas DESC;"

Retiro_Fallas_Parada_boxes_2015 <- dbGetQuery(con, Retiro_Fallas_Parada_boxes_2015)
```

```{r}
## Número DE RETIROS POR FALLAS MECANICAS y PARADAS EN LOS BOXES EN EL AÑO 2014

Retiro_Fallas_Parada_boxes_2014 <- "SELECT r.year AS Año,
       r.name AS carrera,
       d.forename || ' ' || d.driverRef AS Piloto,
       COUNT(DISTINCT CASE WHEN s.status like '%Mechanical%' OR '%Electrical%' OR '%Engine misfire%' OR '%Engine fire%'  THEN res.resultId END) AS retiros_por_fallas_mecanicas,
       COUNT(DISTINCT ps.stop) AS paradas_en_boxes
FROM drivers d INNER JOIN results res ON d.driverId = res.driverId
INNER JOIN driver_standings e ON d.driverId = e.driverId
INNER JOIN races r ON res.raceId = r.raceId
LEFT JOIN status s ON res.statusId = s.statusId
LEFT JOIN pitstops ps ON d.driverId = ps.driverId AND r.raceId = ps.raceId
WHERE r.year == 2014 AND d.driverRef IN ('rosberg', 'hamilton', 'ricciardo', 'alonso', 'bottas')
GROUP BY d.driverId, r.raceId
ORDER BY paradas_en_boxes AND retiros_por_fallas_mecanicas DESC;"

Retiro_Fallas_Parada_boxes_2014 <- dbGetQuery(con, Retiro_Fallas_Parada_boxes_2014)
```

```{r}
## Número DE RETIROS POR FALLAS MECANICAS y PARADAS EN LOS BOXES EN EL AÑO 2013 ##

Retiro_Fallas_Parada_boxes_2013 <- "SELECT r.year AS Año,
       r.name AS carrera,
       d.forename || ' ' || d.driverRef AS Piloto,
       COUNT(DISTINCT CASE WHEN s.status like '%Mechanical%' OR '%Electrical%' OR '%Engine misfire%' OR '%Engine fire%'  THEN res.resultId END) AS retiros_por_fallas_mecanicas,
       COUNT(DISTINCT ps.stop) AS paradas_en_boxes
FROM drivers d INNER JOIN results res ON d.driverId = res.driverId
INNER JOIN driver_standings e ON d.driverId = e.driverId
INNER JOIN races r ON res.raceId = r.raceId
LEFT JOIN status s ON res.statusId = s.statusId
LEFT JOIN pitstops ps ON d.driverId = ps.driverId AND r.raceId = ps.raceId
WHERE r.year == 2013 AND d.driverRef IN ('vettel', 'alonso', 'raikkonen', 'hamilton', 'webber')
GROUP BY d.driverId, r.raceId
ORDER BY paradas_en_boxes AND retiros_por_fallas_mecanicas DESC;"

Retiro_Fallas_Parada_boxes_2013 <- dbGetQuery(con, Retiro_Fallas_Parada_boxes_2013)
```
